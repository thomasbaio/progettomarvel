<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Marvel Card Vault (MCV) - Buy credits page">
    <title>Buy credits</title>
    <!-- Logo -->
    <link rel="icon" href="../images/logo.png" type="image/x-icon">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/card.css">
    <!-- Bootstrap CSS for layout and components -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <!-- Navigation bar, filled via JS -->
    <div id="menu"></div>
    <div class="container-fluid text-center">
        <div class="row">
            <div class="col-12">
                <h1>Buy Credits</h1>
            </div>
        </div>
        <div class="row">
            <p>Here you can buy credits to purchase card packages.</p>
            <p>You currently have <span class="current_credits"></span> credits</p>
        </div>
        <!-- Credit packages selection -->
        <div class="row p-4 md-4">
            <div class="col-12">
                <div class="btn-group mr-2" role="group">
                    <!-- Each button represents a credit package -->
                    <button class="btn btn-info btn-lg" data-credits="5"> 5€ <br><hr> 5 Credits</button>
                    <button class="btn btn-info btn-lg" data-credits="12"> 10€ <br><hr> 12 Credits</button>
                    <button class="btn btn-info btn-lg" data-credits="18"> 15€ <br><hr> 18 Credits</button>
                </div>
                <br><br>
                <div class="btn-group mr-2" role="group">
                    <button class="btn btn-info btn-lg" data-credits="24"> 20€ <br><hr> 24 Credits</button>
                    <button class="btn btn-info btn-lg" data-credits="30"> 25€ <br><hr> 30 Credits</button>
                    <button class="btn btn-info btn-lg" data-credits="60"> 50€ <br><hr> 60 Credits</button>
                </div>
            </div>	
        </div>
        <!-- Buy button (disabled until a package is selected) -->
        <div class="row">
            <div class="col-12">
                <button id="buy" class="btn btn-lg btn-warning" disabled>
                    <i class="fas fa-shopping-cart"></i>&nbsp;Buy
                </button>
            </div>
        </div>
        <!-- Payment icons row -->
        <div class="row">
            <div class="col-12 md-4 p-4">
                <i class="fab fa-2x fa-paypal p-4"></i>
                <i class="fab fa-2x fa-apple-pay p-4"></i>
                <i class="fab fa-2x fa-amazon-pay p-4"></i>
                <i class="fab fa-2x fa-google-pay p-4"></i>
                <i class="fas fa-2x fa-credit-card p-4"></i>
            </div>
        </div>
    </div>
    <footer id="footer"></footer>

    <script>
        // Variabile che contiene l'importo selezionato
        let selectedAmount = null;

        // Aggancia i click handler ai bottoni dei pacchetti crediti
        document.querySelectorAll('.btn-info').forEach(button => {
            button.addEventListener('click', function() {
                // Ripristina colore default per tutti i bottoni selezionabili
                document.querySelectorAll('.btn-success').forEach(b => {
                    b.classList.remove('btn-success');
                    b.classList.add('btn-info');
                });
                // Evidenzia il bottone selezionato
                this.classList.remove('btn-info');
                this.classList.add('btn-success');
                selectedAmount = Number(this.getAttribute('data-credits'));

                // Abilita il bottone di acquisto
                document.getElementById('buy').disabled = false;
            });
        });

        // Gestione click sul bottone di acquisto crediti
        document.getElementById('buy').addEventListener('click', function() {
            if (selectedAmount) {
                fetch(`/edit-credits`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'username': localStorage.getItem('username'),
                        'credits': selectedAmount
                    }
                })
                .then(response => response.json())
                .then(data => {
                    alert("Credits purchased. You now have " + data.credits + " credits");
                    printCredits();
                    localStorage.setItem("credits", data.credits);
                })
                .catch(error => console.error('Error:', error));
            }
        });
    </script>

    <!-- Import dei JS comuni -->
    <script src="../scripts/theme.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="../scripts/marvel.js"></script>
    <script src="../scripts/navbar.js"></script>
    <script src="../scripts/login.js"></script>
    <script type="module" src="../scripts/footer.js"></script>
    <script>
        // Mostra il credito corrente all'utente
        printCredits();
    </script>
    <!-- end of import of JS -->
</body>
</html>
